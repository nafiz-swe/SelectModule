<!DOCTYPE html>
<html>
<head>
  <title>ЁЯФФ Alarm Monitor - {{ level|upper }}</title>
</head>
<body>
  <h2>ЁЯУб Watching for "Select Module" in {{ level|upper }}...</h2>
  <p>ржпржЦржи рж╕ржарж┐ржХ рж▓рзЗржЦрж╛ ржкрж╛ржУржпрж╝рж╛ ржпрж╛ржмрзЗ, рждржЦржи ржЕрзНржпрж╛рж▓рж╛рж░рзНржо ржмрж╛ржЬржмрзЗ ржПржмржВ ржирждрзБржи ржкрзЗржЬ ржЦрзБрж▓ржмрзЗред</p>

<!-- watch.html -->
<audio id="alarm-audio" style="display: none;">
  <source src="/static/audio/selectmodule_alarm.mp3" type="audio/mpeg">
</audio>

<script>
  const params = new URLSearchParams(location.search);
  const level = params.get('watch') || '';

  if (level) {
    let alarmTriggered = false;

    async function poll() {
      if (alarmTriggered) return;

      const res = await fetch(`/check-audio/${level}`);
      const data = await res.json();

      if (data.play) {
        alarmTriggered = true;

        const audio = document.getElementById("alarm-audio");
        const playPromise = audio.play();

        if (playPromise !== undefined) {
          playPromise.catch(() => {
            alert("Click anywhere to hear alarm sound!");
            document.body.addEventListener("click", () => audio.play());
          });
        }
      }
    }

    setInterval(poll, 3000);
  }
</script>

</body>
</html>
